# User Flows: BIOMAX AI v2.0

**Версия:** 1.0  
**Дата создания:** 2026-01-26  
**Автор:** UX Agent  
**Статус:** Draft

---

## Overview

Документ описывает ключевые User Flows платформы BIOMAX AI v2.0 на основе 21 User Story для трёх персон:
- **Алексей** (Advanced Biohacker)
- **Марина** (Health Optimizer)
- **Дмитрий** (Longevity Seeker)

Flows приоритизированы по критичности (P0 → P1) и охватывают MVP-функционал.

---

## Flow 1: Onboarding и подключение устройств

### Context
- **User:** Все персоны (первый контакт)
- **Goal:** Зарегистрироваться и подключить первый источник данных
- **Entry Points:** Landing page, Telegram bot, App Store
- **Success Criteria:** Профиль создан, минимум 1 устройство подключено
- **Related US:** US-008 (Apple Watch), US-001 (Дашборд)

### Happy Path

```
[Start: Landing / App Store / Telegram]
    │
    ▼
┌─────────────────────────────────────┐
│ Step 1: Welcome Screen              │
│ Screen: Welcome                     │
│ "Начни управлять здоровьем с AI"    │
│ [Начать] [Войти]                    │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ Step 2: Регистрация                 │
│ Screen: Registration                │
│ Email / Телефон / Telegram OAuth    │
│ Согласие на обработку данных (152-ФЗ)│
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ Step 3: Базовый профиль             │
│ Screen: Profile Setup               │
│ - Имя, возраст, пол                 │
│ - Основная цель (выбор из 5)        │
│ - Текущие устройства (чекбоксы)     │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ Step 4: Подключение устройства      │
│ Screen: Connect Device              │
│ Карточки устройств: Oura, Apple     │
│ Watch, WHOOP, CGM, Manual           │
│ [Подключить] → OAuth flow           │
└─────────────────────────────────────┘
    │
    ├── Apple Watch ──► HealthKit OAuth ──► Success
    │
    ├── Oura Ring ──► Oura OAuth 2.0 ──► Success
    │
    └── Пропустить ──► Manual Entry Mode
    │
    ▼
┌─────────────────────────────────────┐
│ Step 5: Первичный скан данных       │
│ Screen: Data Sync                   │
│ "Загружаем ваши данные..."          │
│ Progress bar (30-60 сек)            │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ Step 6: Первый Health Score         │
│ Screen: Initial Score               │
│ "Ваш Health Score: 72"              │
│ Breakdown по измерениям             │
│ [Перейти к плану] [Подключить ещё]  │
└─────────────────────────────────────┘
    │
    ▼
[End: Dashboard / План действий]
```

### Alternative Paths

#### Alt 1: Вход через Telegram
- Trigger: Пользователь начинает с /start в Telegram боте
- Flow: Telegram OAuth → WebApp для профиля → Бот для взаимодействий
- Outcome: Профиль связан с Telegram, push через бота

#### Alt 2: Вход через существующий аккаунт
- Trigger: Нажатие "Войти" на Welcome Screen
- Flow: Email/Telegram → Проверка → Dashboard
- Outcome: Прямой доступ к существующему профилю

### Error States

| Step | Error Condition | User Feedback | Recovery Path |
|------|-----------------|---------------|---------------|
| 2 | Email уже существует | "Этот email уже зарегистрирован" | Предложить войти или восстановить пароль |
| 4 | OAuth отклонён | "Не удалось подключить устройство" | Повторить или пропустить |
| 5 | API timeout | "Не удалось загрузить данные" | Retry через 30 сек или manual entry |
| 5 | Нет данных в устройстве | "Данных пока нет, начните носить устройство" | Предложить базовую анкету |

### Edge Cases
1. **Пользователь без устройств:** Предложить manual entry + опросник PHQ-9/GAD-7
2. **Несколько устройств одного типа:** Выбор "основного" устройства
3. **Устройство без данных за 30 дней:** Предупреждение о неполноте анализа

---

## Flow 2: Просмотр дашборда биомаркеров

### Context
- **User:** Алексей (Advanced Biohacker)
- **Goal:** Увидеть все биомаркеры в едином месте
- **Entry Points:** Главный экран после логина
- **Success Criteria:** Все подключённые данные отображаются с трендами
- **Related US:** US-001

### Happy Path

```
[Start: Login / App Open]
    │
    ▼
┌─────────────────────────────────────┐
│ Step 1: Dashboard Loading           │
│ Screen: Dashboard                   │
│ Skeleton loader (2-3 сек)           │
│ Background data refresh             │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ Step 2: Health Score Overview       │
│ Screen: Dashboard (loaded)          │
│ Большой Health Score (72/100)       │
│ Тренд за неделю (+3)                │
│ 8 измерений с мини-индикаторами     │
└─────────────────────────────────────┘
    │
    ├── Tap на Health Score ──► Breakdown Screen
    │
    ▼
┌─────────────────────────────────────┐
│ Step 3: Карточки метрик             │
│ Screen: Dashboard (scroll)          │
│ ┌─────────┐  ┌─────────┐            │
│ │ Sleep   │  │ HRV     │            │
│ │ 7.2h ↑  │  │ 52ms →  │            │
│ └─────────┘  └─────────┘            │
│ ┌─────────┐  ┌─────────┐            │
│ │ Glucose │  │ Labs    │            │
│ │ TIR 89% │  │ 3 flags │            │
│ └─────────┘  └─────────┘            │
└─────────────────────────────────────┘
    │
    ├── Tap на карточку ──► Detail View
    │
    ▼
┌─────────────────────────────────────┐
│ Step 4: Детальный просмотр метрики  │
│ Screen: Metric Detail               │
│ - График за 7/30/90 дней            │
│ - Текущее значение vs целевое       │
│ - AI-инсайты от агента              │
│ - Связанные рекомендации            │
└─────────────────────────────────────┘
    │
    ▼
[End: Action / Back to Dashboard]
```

### Alternative Paths

#### Alt 1: Новые данные из лаборатории
- Trigger: Загружены анализы крови (PDF или API)
- Flow: Dashboard → "Новые данные!" badge → Lab Results Screen
- Outcome: Интерпретация Lab Interpreter Agent

#### Alt 2: Аномалия обнаружена
- Trigger: Data Scientist Agent выявил отклонение
- Flow: Dashboard → Red flag на карточке → Alert Detail
- Outcome: Рекомендация Safety Agent

### Error States

| Step | Error Condition | User Feedback | Recovery Path |
|------|-----------------|---------------|---------------|
| 1 | API недоступен | Показать кэшированные данные + timestamp | Pull-to-refresh |
| 2 | Нет данных за 7 дней | "Данные устарели" | Предложить синхронизацию |
| 3 | Устройство отключено | Серая карточка + "Переподключить" | OAuth flow |

### Edge Cases
1. **Первый день использования:** Показать "Недостаточно данных для трендов"
2. **Множество источников одной метрики:** Приоритет по accuracy (CGM > manual)
3. **Противоречивые данные:** Пометка "Требует проверки" + объяснение

---

## Flow 3: Загрузка протокола в RAG

### Context
- **User:** Алексей (Advanced Biohacker)
- **Goal:** Добавить протокол Bryan Johnson в базу знаний для персонализации
- **Entry Points:** Раздел "Мои протоколы" / "База знаний"
- **Success Criteria:** Протокол обработан, доступен для AI-агентов
- **Related US:** US-002

### Happy Path

```
[Start: Dashboard → "Мои протоколы"]
    │
    ▼
┌─────────────────────────────────────┐
│ Step 1: Список протоколов           │
│ Screen: My Protocols                │
│ Пусто / существующие протоколы      │
│ [+ Добавить протокол]               │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ Step 2: Выбор файла                 │
│ Screen: Add Protocol                │
│ Drag & Drop зона                    │
│ [Выбрать файл] PDF/MD/TXT           │
│ или URL на публичный документ       │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ Step 3: Preview и метаданные        │
│ Screen: Protocol Preview            │
│ - Preview содержимого               │
│ - Название: "Bryan Johnson Blueprint"│
│ - Автор: "Bryan Johnson"            │
│ - Категория: [Longevity ▼]          │
│ - Теги: добавки, режим, протоколы   │
│ [Отмена] [Обработать]               │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ Step 4: Обработка RAG Pipeline      │
│ Screen: Processing                  │
│ "Обрабатываем протокол..."          │
│ ├── Извлечение текста ✓             │
│ ├── Разбиение на фрагменты ✓        │
│ ├── Создание embeddings ●           │
│ └── Индексация в базу знаний        │
│ Прогресс: 67%                       │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ Step 5: Успешная загрузка           │
│ Screen: Protocol Added              │
│ "Протокол добавлен! ✓"              │
│ "45 фрагментов в базе знаний"       │
│ [Задать вопрос по протоколу]        │
│ [Вернуться к списку]                │
└─────────────────────────────────────┘
    │
    ▼
[End: My Protocols / Ask AI]
```

### Alternative Paths

#### Alt 1: Загрузка по URL
- Trigger: Вставка URL (notion.so, github, pdf link)
- Flow: URL → Fetch → Preview → Processing
- Outcome: Автоматическое извлечение контента

#### Alt 2: Дубликат протокола
- Trigger: Файл уже существует в базе
- Flow: Preview → "Протокол уже загружен" → [Обновить] [Отмена]
- Outcome: Версионирование или отмена

### Error States

| Step | Error Condition | User Feedback | Recovery Path |
|------|-----------------|---------------|---------------|
| 2 | Неподдерживаемый формат | "Поддерживаются PDF, MD, TXT" | Конвертация или manual copy |
| 3 | Файл слишком большой (>50MB) | "Файл превышает лимит" | Разбить на части |
| 4 | Ошибка парсинга | "Не удалось извлечь текст" | Manual entry или OCR |
| 4 | Timeout обработки | "Обработка занимает больше времени" | Background processing + notification |

### Edge Cases
1. **Сканированный PDF:** OCR fallback + предупреждение о качестве
2. **Многоязычный документ:** Определение языка, приоритет русский/английский
3. **Файл с DRM:** "Защищённый файл, скопируйте текст вручную"

---

## Flow 4: Интерпретация анализов крови

### Context
- **User:** Марина (Health Optimizer)
- **Goal:** Понять результаты анализов простым языком
- **Entry Points:** Раздел "Анализы" / Загрузка PDF
- **Success Criteria:** Показатели интерпретированы с рекомендациями
- **Related US:** US-011

### Happy Path

```
[Start: "Анализы" → "Загрузить"]
    │
    ▼
┌─────────────────────────────────────┐
│ Step 1: Выбор источника             │
│ Screen: Upload Labs                 │
│ [Загрузить PDF] [INVITRO API]       │
│ [Helix API] [Ввести вручную]        │
└─────────────────────────────────────┘
    │
    ├── PDF Upload ──► File Picker ──► Step 2
    │
    ├── INVITRO API ──► OAuth ──► Auto-import ──► Step 3
    │
    └── Manual ──► Form Entry ──► Step 3
    │
    ▼
┌─────────────────────────────────────┐
│ Step 2: Парсинг PDF                 │
│ Screen: Processing Labs             │
│ "Извлекаем показатели..."           │
│ OCR + structured extraction         │
│ 15-30 сек                           │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ Step 3: Подтверждение показателей   │
│ Screen: Confirm Results             │
│ Таблица извлечённых показателей     │
│ [Править] если ошибка               │
│ Дата анализа: [26.01.2026]          │
│ [Отмена] [Анализировать]            │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ Step 4: AI-интерпретация            │
│ Screen: Lab Results                 │
│ Lab Interpreter Agent работает      │
│ "Анализируем показатели..."         │
│ (10-15 сек)                         │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ Step 5: Результаты с пояснениями    │
│ Screen: Interpreted Results         │
│                                     │
│ 🟢 Гемоглобин: 145 г/л              │
│    "Отличный показатель!"           │
│                                     │
│ 🟡 Витамин D: 22 нг/мл              │
│    "Ниже оптимального (30-50)"      │
│    → Рекомендация: D3 2000 IU       │
│                                     │
│ 🔴 hs-CRP: 3.2 мг/л                 │
│    "Повышенное воспаление"          │
│    → Консультация врача             │
│                                     │
│ [Подробнее] [Задать вопрос AI]      │
└─────────────────────────────────────┘
    │
    ▼
[End: Detailed View / Ask AI / Share with Doctor]
```

### Alternative Paths

#### Alt 1: Повторный анализ (сравнение)
- Trigger: У пользователя есть предыдущие анализы
- Flow: New Results → Comparison View → Trends
- Outcome: "Витамин D улучшился с 15 до 22 нг/мл (+47%)"

### Error States

| Step | Error Condition | User Feedback | Recovery Path |
|------|-----------------|---------------|---------------|
| 2 | PDF нечитаемый | "Не удалось распознать текст" | Manual entry form |
| 2 | Неизвестный формат лаборатории | "Лаборатория не распознана" | Generic parser + manual confirm |
| 4 | Неизвестный показатель | "Показатель X не в базе" | Skip + log для добавления |

### Edge Cases
1. **Анализы из другой страны:** Конвертация единиц измерения
2. **Устаревшие референсы:** Использование актуальных longevity-оптимальных значений
3. **Критические значения:** Немедленный alert + рекомендация обратиться к врачу

---

## Flow 5: Рекомендации "С чего начать"

### Context
- **User:** Марина (Health Optimizer)
- **Goal:** Получить простой план из 3-5 действий
- **Entry Points:** Onboarding → "Мой план" / Dashboard CTA
- **Success Criteria:** Персонализированный план без перегрузки
- **Related US:** US-009

### Happy Path

```
[Start: Post-Onboarding / Dashboard]
    │
    ▼
┌─────────────────────────────────────┐
│ Step 1: Анализ профиля              │
│ Screen: Loading Plan                │
│ Coach Agent + специализированные    │
│ агенты анализируют данные           │
│ "Создаём ваш персональный план..."  │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ Step 2: План действий               │
│ Screen: My Plan                     │
│                                     │
│ "Ваш план на ближайшие 2 недели"    │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 1️⃣ Ложиться до 23:00            │ │
│ │ Приоритет: Критичный            │ │
│ │ "Сон — фундамент здоровья"      │ │
│ │ [Подробнее] [Начать]            │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 2️⃣ 10-минутная прогулка утром   │ │
│ │ Приоритет: Высокий              │ │
│ │ "Свет утром улучшит сон вечером"│ │
│ │ [Подробнее] [Начать]            │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 3️⃣ Выключить экраны за час      │ │
│ │ до сна                          │ │
│ │ [Подробнее] [Начать]            │ │
│ └─────────────────────────────────┘ │
└─────────────────────────────────────┘
    │
    ├── [Подробнее] ──► Detail Screen
    │
    ▼
┌─────────────────────────────────────┐
│ Step 3: Детали действия             │
│ Screen: Action Detail               │
│                                     │
│ "Ложиться до 23:00"                 │
│                                     │
│ 📖 Почему это важно:                │
│ "Ваши данные показывают, что вы     │
│ засыпаете после 00:30. Это нарушает │
│ циркадные ритмы и снижает качество  │
│ глубокого сна на 20-30%."           │
│                                     │
│ ✅ Конкретные шаги:                 │
│ 1. Установите будильник на 22:30    │
│ 2. Начните ритуал подготовки ко сну │
│ 3. Затемните комнату                │
│                                     │
│ 📈 Ожидаемый результат:             │
│ "Через 2 недели вы почувствуете     │
│ больше энергии утром"               │
│                                     │
│ [Включить напоминание в Telegram]   │
│ [Отметить как выполнено]            │
└─────────────────────────────────────┘
    │
    ▼
[End: Action Started / Reminder Set]
```

### Alternative Paths

#### Alt 1: Все действия выполнены
- Trigger: Пользователь выполнил 3/3 действия за 2 недели
- Flow: Plan → "Отлично! 🎉" → New Plan (Level 2)
- Outcome: Progression к более продвинутым рекомендациям

#### Alt 2: Пользователь не согласен с рекомендацией
- Trigger: Нажатие "Это мне не подходит"
- Flow: Detail → "Почему?" (выбор) → Alternative Recommendation
- Outcome: Адаптация плана под feedback

### Error States

| Step | Error Condition | User Feedback | Recovery Path |
|------|-----------------|---------------|---------------|
| 1 | Недостаточно данных | "Нужно больше данных для плана" | Базовый generic план + запрос данных |
| 2 | Противоречивые цели | "Уточните приоритет" | Выбор фокуса (сон vs энергия vs стресс) |

### Edge Cases
1. **Пользователь уже делает это:** "Отлично, вы уже это делаете!" → следующий пункт
2. **Медицинские ограничения:** Safety Agent проверяет + адаптация
3. **Сезонность:** Разные рекомендации зимой/летом (свет, витамин D)

---

## Flow 6: Telegram-взаимодействие с AI

### Context
- **User:** Все персоны
- **Goal:** Быстро задать вопрос AI без открытия приложения
- **Entry Points:** Telegram бот @biomax_ai_bot
- **Success Criteria:** Ответ в течение 10 секунд с учётом контекста
- **Related US:** US-006, US-010

### Happy Path

```
[Start: Telegram → @biomax_ai_bot]
    │
    ▼
┌─────────────────────────────────────┐
│ Step 1: Отправка сообщения          │
│ Chat: Telegram                      │
│                                     │
│ User: "Какой протокол NMN лучше     │
│        для моего возраста?"         │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ Step 2: Обработка Orchestrator      │
│ Backend: Agent Routing              │
│ - Классификация: Longevity          │
│ - Активация: Longevity Agent        │
│ - Контекст: возраст 35, генетика    │
│ - RAG: пользовательские протоколы   │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ Step 3: Формирование ответа         │
│ Backend: Longevity Agent            │
│ - Анализ профиля                    │
│ - RAG retrieval (Blueprint + PubMed)│
│ - Safety check                      │
│ - Response generation               │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ Step 4: Ответ в Telegram            │
│ Chat: Telegram                      │
│                                     │
│ Bot: "Учитывая ваш возраст (35 лет) │
│ и данные, рекомендую:               │
│                                     │
│ 📊 NMN 500mg утром натощак          │
│                                     │
│ Обоснование:                        │
│ • Согласно вашему протоколу         │
│   Blueprint, это оптимальная доза   │
│ • Исследование Imai et al. 2016     │
│   показало безопасность             │
│                                     │
│ ⚠️ Рекомендую проверить NAD+        │
│ уровень через 3 месяца"             │
│                                     │
│ [Подробнее в приложении]            │
│ [Добавить в протокол]               │
└─────────────────────────────────────┘
    │
    ▼
[End: User satisfied / Follow-up question]
```

### Alternative Paths

#### Alt 1: Быстрые команды
- Trigger: /sleep, /hrv, /glucose
- Flow: Command → Quick Summary → Dashboard link
- Outcome: Краткая сводка метрики за 7 дней

#### Alt 2: Контекстный follow-up
- Trigger: "А если я принимаю метформин?"
- Flow: Context preserved → Safety Agent check → Updated recommendation
- Outcome: Учёт взаимодействий

### Error States

| Step | Error Condition | User Feedback | Recovery Path |
|------|-----------------|---------------|---------------|
| 2 | Rate limit exceeded | "Лимит запросов исчерпан (Free: 10/день)" | Upgrade CTA |
| 3 | Agent timeout | "Обработка занимает больше времени..." | Async response + notification |
| 4 | Sensitive medical question | Disclaimer + "Проконсультируйтесь с врачом" | Safe response + doctor recommendation |

### Edge Cases
1. **Неавторизованный пользователь:** Предложение регистрации
2. **Вопрос вне scope:** "Этот вопрос выходит за рамки wellness" + redirect
3. **Голосовое сообщение:** Whisper transcription → text processing

---

## Flow 7: Загрузка эпигенетического теста

### Context
- **User:** Дмитрий (Longevity Seeker)
- **Goal:** Понять биологический возраст и получить научные рекомендации
- **Entry Points:** Раздел "Эпигенетика" / "Долголетие"
- **Success Criteria:** Биовозраст интерпретирован с протоколом оптимизации
- **Related US:** US-015, US-019

### Happy Path

```
[Start: "Долголетие" → "Биологический возраст"]
    │
    ▼
┌─────────────────────────────────────┐
│ Step 1: Выбор теста                 │
│ Screen: Epigenetic Tests            │
│ [TruDiagnostic PDF]                 │
│ [GlycanAge] [Elysium]               │
│ [Другой тест]                       │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ Step 2: Загрузка PDF                │
│ Screen: Upload                      │
│ Drag & Drop зона                    │
│ "Загрузите PDF с результатами       │
│  TruDiagnostic"                     │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ Step 3: Парсинг и извлечение        │
│ Screen: Processing                  │
│ "Извлекаем данные..."               │
│ ├── Хронологический возраст ✓       │
│ ├── GrimAge ●                       │
│ ├── DunedinPACE                     │
│ └── Метилирование                   │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ Step 4: Научная интерпретация       │
│ Screen: Biological Age Results      │
│                                     │
│ 📊 Ваш биологический возраст        │
│                                     │
│ Хронологический: 55 лет             │
│ Биологический:   52.3 года          │
│ ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│ 🎉 Вы на 2.7 года моложе!           │
│                                     │
│ DunedinPACE: 0.95                   │
│ "Вы стареете со скоростью 95%       │
│  от среднего. Цель: <0.90"          │
│                                     │
│ 📚 Научное обоснование:             │
│ "GrimAge основан на метилировании   │
│  1030 CpG сайтов (Lu et al., 2019)" │
│                                     │
│ [Подробный анализ]                  │
│ [Получить протокол оптимизации]     │
└─────────────────────────────────────┘
    │
    ├── [Протокол оптимизации] ──►
    │
    ▼
┌─────────────────────────────────────┐
│ Step 5: Персонализированный протокол│
│ Screen: Longevity Protocol          │
│                                     │
│ "Протокол снижения биовозраста"     │
│                                     │
│ 1️⃣ Интервальное голодание 16:8     │
│    📖 Mattson et al., 2017          │
│    📈 -5-8% метилирование           │
│                                     │
│ 2️⃣ Zone 2 кардио 3x/неделю         │
│    📖 Levine et al., 2018           │
│    📈 Улучшение метаболизма         │
│                                     │
│ 3️⃣ NMN 500mg утром                 │
│    📖 Sinclair et al., 2023         │
│    ⚠️ Проверено Safety Agent        │
│                                     │
│ [Начать протокол] [Экспорт PDF]     │
└─────────────────────────────────────┘
    │
    ▼
[End: Protocol Started / Shared with Doctor]
```

### Alternative Paths

#### Alt 1: Повторный тест (сравнение)
- Trigger: Загружен второй тест через 6-12 месяцев
- Flow: New Test → Comparison → "Биовозраст снизился на 1.5 года!"
- Outcome: Validation протокола

### Error States

| Step | Error Condition | User Feedback | Recovery Path |
|------|-----------------|---------------|---------------|
| 3 | Неизвестный формат теста | "Формат теста не распознан" | Manual entry + support |
| 4 | Данные неполные | "Некоторые метрики недоступны" | Partial interpretation |

### Edge Cases
1. **Биовозраст выше хронологического:** Мягкое сообщение + план действий
2. **Первый тест (нет baseline):** "Сохраним для сравнения через 6 месяцев"
3. **Очень низкий DunedinPACE:** Поздравление + "Поддерживайте"

---

## Flow 8: Поиск научных исследований

### Context
- **User:** Дмитрий (Longevity Seeker)
- **Goal:** Найти научные обоснования для протокола
- **Entry Points:** Раздел "Исследования" / AI-ответ "Подробнее"
- **Success Criteria:** Релевантные исследования с интерпретацией
- **Related US:** US-017

### Happy Path

```
[Start: "Исследования" / Question follow-up]
    │
    ▼
┌─────────────────────────────────────┐
│ Step 1: Поисковый запрос            │
│ Screen: Research Search             │
│                                     │
│ 🔍 [Эффективность NMN для снижения  │
│     биологического возраста у людей]│
│                                     │
│ Фильтры: [RCT ▼] [2020-2026 ▼]      │
│          [Humans only ☑]            │
│                                     │
│ [Искать]                            │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ Step 2: Research Agent обработка    │
│ Backend: PubMed + Semantic Scholar  │
│ 10-15 секунд                        │
│ "Ищем релевантные исследования..."  │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ Step 3: Результаты поиска           │
│ Screen: Search Results              │
│                                     │
│ Найдено: 12 исследований            │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 🅰️ RCT | Yi et al., 2023       │ │
│ │ "NMN supplementation enhances   │ │
│ │  aerobic capacity in humans"    │ │
│ │ n=48, 12 недель, p<0.05         │ │
│ │ [Подробнее]                     │ │
│ └─────────────────────────────────┘ │
│                                     │
│ ┌─────────────────────────────────┐ │
│ │ 🅱️ Observational | Kim, 2022   │ │
│ │ "Long-term NMN safety profile"  │ │
│ │ n=250, 24 месяца                │ │
│ │ [Подробнее]                     │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 📊 AI-сводка:                       │
│ "Большинство исследований показывают│
│  положительный эффект NMN. Уровень  │
│  доказательности: B (ограниченные   │
│  RCT, нужны долгосрочные данные)"   │
└─────────────────────────────────────┘
    │
    ├── [Подробнее] ──►
    │
    ▼
┌─────────────────────────────────────┐
│ Step 4: Детали исследования         │
│ Screen: Study Detail                │
│                                     │
│ "NMN supplementation enhances..."   │
│ Yi et al., Nature Communications    │
│                                     │
│ 📋 Методология:                     │
│ • Рандомизированное двойное слепое  │
│ • Плацебо-контролируемое            │
│                                     │
│ 👥 Участники:                       │
│ • n=48, возраст 50-70 лет           │
│ • Здоровые, без хронических         │
│                                     │
│ 📈 Результаты:                      │
│ • VO2max +12% (p<0.05)              │
│ • Улучшение выносливости            │
│                                     │
│ ⚠️ Ограничения:                     │
│ • Небольшая выборка                 │
│ • Короткий период наблюдения        │
│                                     │
│ 🔗 Применимость к вам:              │
│ "Результаты применимы к вашему      │
│  профилю (возраст 55, здоровый)"    │
│                                     │
│ [Читать оригинал] [Сохранить]       │
│ [Добавить в протокол]               │
└─────────────────────────────────────┘
    │
    ▼
[End: Saved / Added to Protocol / Read Full]
```

### Alternative Paths

#### Alt 1: Сравнение исследований
- Trigger: Найдены противоречивые результаты
- Flow: Results → Compare View → Synthesis
- Outcome: "2 из 3 исследований показывают эффект"

### Error States

| Step | Error Condition | User Feedback | Recovery Path |
|------|-----------------|---------------|---------------|
| 2 | Нет результатов | "Исследований не найдено" | Расширить критерии |
| 2 | PubMed недоступен | "Временные проблемы с поиском" | Использовать кэш + retry |

### Edge Cases
1. **Препринты vs peer-reviewed:** Пометка "Препринт — не рецензировано"
2. **Ретрактнутые статьи:** Исключение из результатов
3. **Исследования на животных:** Отдельная секция с disclaimer

---

## Flow 9: N=1 Эксперимент

### Context
- **User:** Алексей (Advanced Biohacker)
- **Goal:** Научно проверить эффект добавки/протокола
- **Entry Points:** Biohacker Lab / "Добавки" → "Проверить эффект"
- **Success Criteria:** Статистически значимый результат с визуализацией
- **Related US:** US-005, US-003

### Happy Path

```
[Start: "Biohacker Lab" → "Новый эксперимент"]
    │
    ▼
┌─────────────────────────────────────┐
│ Step 1: Создание эксперимента       │
│ Screen: Create Experiment           │
│                                     │
│ Название:                           │
│ [Магний глицинат для deep sleep]    │
│                                     │
│ Гипотеза:                           │
│ [Магний увеличит deep sleep на 15%] │
│                                     │
│ Интервенция:                        │
│ [400mg магния за 2ч до сна]         │
│                                     │
│ Метрики для отслеживания:           │
│ ☑ Deep sleep (Oura)                 │
│ ☑ Субъективная оценка утром         │
│ ☐ HRV                               │
│                                     │
│ Длительность:                       │
│ Baseline: [2 недели]                │
│ Интервенция: [4 недели]             │
│                                     │
│ [Создать эксперимент]               │
└─────────────────────────────────────┘
    │
    ▼
┌─────────────────────────────────────┐
│ Step 2: Baseline период             │
│ Screen: Experiment Running          │
│                                     │
│ 📊 Эксперимент: Магний глицинат     │
│ Фаза: Baseline (день 7 из 14)       │
│                                     │
│ Текущие данные:                     │
│ Deep sleep: 68 мин (среднее)        │
│ Variance: ±12 мин                   │
│                                     │
│ ⏳ До интервенции: 7 дней           │
│                                     │
│ [Детали] [Остановить]               │
└─────────────────────────────────────┘
    │
    ▼ (через 2 недели)
    │
┌─────────────────────────────────────┐
│ Step 3: Интервенция                 │
│ Screen: Experiment Running          │
│                                     │
│ 📊 Эксперимент: Магний глицинат     │
│ Фаза: Интервенция (неделя 2 из 4)   │
│                                     │
│ ⚡ Промежуточные результаты:        │
│ Deep sleep: 76 мин (+12%)           │
│ Вероятность эффекта: 72%            │
│                                     │
│ 📅 Compliance: 13/14 дней           │
│ [Отметить приём сегодня]            │
│                                     │
│ [Детали] [Остановить]               │
└─────────────────────────────────────┘
    │
    ▼ (через 4 недели)
    │
┌─────────────────────────────────────┐
│ Step 4: Финальный отчёт             │
│ Screen: Experiment Results          │
│                                     │
│ 🎉 Эксперимент завершён!            │
│                                     │
│ ═══════════════════════════════════ │
│                                     │
│ 📊 Результаты:                      │
│                                     │
│ Deep Sleep                          │
│ Baseline:     68 мин                │
│ Intervention: 80 мин                │
│ Изменение:    +18% ✅               │
│                                     │
│ [Graph: Before/After with CI]       │
│                                     │
│ 📈 Статистика:                      │
│ p-value: 0.03 (значимо)             │
│ Effect size: 0.65 (средний)         │
│ Confidence: 95%                     │
│                                     │
│ ✅ Вывод:                           │
│ "Эксперимент успешен! Магний        │
│  значимо улучшил deep sleep"        │
│                                     │
│ 💡 Рекомендация:                    │
│ "Интегрируйте в базовый протокол"   │
│                                     │
│ [Добавить в протокол]               │
│ [Повторить эксперимент]             │
│ [Экспорт данных]                    │
└─────────────────────────────────────┘
    │
    ▼
[End: Protocol Updated / Shared / New Experiment]
```

### Alternative Paths

#### Alt 1: Эксперимент не показал эффекта
- Trigger: p-value > 0.05
- Flow: Results → "Эффект не подтверждён" → Recommendations
- Outcome: "Попробуйте увеличить дозу или длительность"

#### Alt 2: Досрочное завершение
- Trigger: Пользователь прекращает интервенцию
- Flow: Stop → Partial Analysis → Limited conclusions
- Outcome: "Данных недостаточно для выводов"

### Error States

| Step | Error Condition | User Feedback | Recovery Path |
|------|-----------------|---------------|---------------|
| 2 | Устройство отключено | "Данные не поступают 3+ дня" | Reconnect + extend baseline |
| 3 | Низкий compliance | "Пропущено много дней" | Warning + extend intervention |

### Edge Cases
1. **Confounding factors:** "Обнаружена корреляция с тренировками — учтено"
2. **Сезонный эффект:** Baseline и intervention в разные сезоны — предупреждение
3. **Множественные интервенции:** "Рекомендуем тестировать по одной"

---

## Сводная таблица User Flows

| Flow | Персона | Приоритет | Ключевые экраны | Агенты |
|------|---------|-----------|-----------------|--------|
| Onboarding | Все | P0 | Welcome, Registration, Profile, Connect Device | - |
| Dashboard | Все | P0 | Dashboard, Metric Detail | Data Scientist, Integration |
| Загрузка протокола | Алексей | P0 | My Protocols, Add Protocol, Preview, Processing | Custom Protocol, RAG Pipeline |
| Интерпретация анализов | Марина | P0 | Upload Labs, Processing, Interpreted Results | Lab Interpreter, Safety |
| Рекомендации "С чего начать" | Марина | P0 | My Plan, Action Detail | Coach, Sleep, Mental Health |
| Telegram AI | Все | P1 | Telegram Chat | Orchestrator, All specialized |
| Эпигенетический тест | Дмитрий | P0 | Upload, Results, Protocol | Longevity, Research, Safety |
| Поиск исследований | Дмитрий | P0 | Research Search, Results, Study Detail | Research |
| N=1 Эксперимент | Алексей | P1 | Create, Running, Results | Coach, Data Scientist |

---

## Cross-Flow Transitions

```
                    ┌─────────────────┐
                    │   Onboarding    │
                    └────────┬────────┘
                             │
                             ▼
              ┌──────────────────────────────┐
              │          Dashboard           │
              │    (Central Navigation)      │
              └──────────────┬───────────────┘
                             │
        ┌────────┬───────────┼───────────┬────────┐
        │        │           │           │        │
        ▼        ▼           ▼           ▼        ▼
    ┌───────┐┌───────┐ ┌──────────┐ ┌───────┐┌───────┐
    │ Labs  ││Protocols│ │ My Plan  │ │Research││ Lab  │
    │Upload ││  RAG   │ │Recommend │ │ Search ││ N=1  │
    └───┬───┘└───┬───┘ └────┬─────┘ └───┬───┘└───┬───┘
        │        │          │           │        │
        └────────┴──────────┴───────────┴────────┘
                            │
                            ▼
                   ┌─────────────────┐
                   │  Telegram Bot   │
                   │ (Quick Access)  │
                   └─────────────────┘
```

---

**Дата создания:** 2026-01-26  
**Статус:** Draft — готово к review  
**Следующие шаги:** Customer Journey Maps, Information Architecture, Wireframes
